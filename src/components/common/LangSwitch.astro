---
interface Props {
  translationSlug?: string;
  variant?: 'link' | 'button';
}

const { translationSlug = '', variant = 'link' } = Astro.props;
const currentLocale = Astro.currentLocale || 'de';

// Get current pathname from the URL
const pathname = Astro.url.pathname;

const isEn = currentLocale === 'en';
const targetLocale = isEn ? 'de' : 'en';
const targetLabel = isEn ? 'Auf Deutsch wechseln' : 'Switch to English';
const targetText = isEn ? 'DE' : 'EN';

// Translation mapping for slugs (legacy/fallback)
const slugMap: Record<string, Record<string, string>> = {
  '/kurse': { en: '/en/classes' },
  '/en/classes': { de: '/kurse' },
  '/preise': { en: '/en/pricing' },
  '/en/pricing': { de: '/preise' },
  '/studio': { en: '/en/studio' },
  '/en/studio': { de: '/studio' },
  '/events': { en: '/en/events' },
  '/en/events': { de: '/events' },
  '/wellness': { en: '/en/wellness' },
  '/en/wellness': { de: '/wellness' },
  '/team': { en: '/en/team' },
  '/en/team': { de: '/team' },
  '/kontakt': { en: '/en/contact' },
  '/en/contact': { de: '/kontakt' },
};

// Determine target path
let targetPath: string;

// Normalize pathname for map lookup (remove trailing slash)
const normalizedPath = pathname.endsWith('/') && pathname.length > 1
  ? pathname.slice(0, -1)
  : pathname;

if (translationSlug) {
  // 1. Use the provided translation slug from frontmatter
  if (isEn) {
    // English -> German
    targetPath = translationSlug === 'home' || translationSlug === '' ? '/' : `/${translationSlug}`;
  } else {
    // German -> English
    targetPath = translationSlug === 'home' || translationSlug === '' ? '/en' : `/en/${translationSlug}`;
  }
} else if (normalizedPath === '/' || normalizedPath === '/en') {
  // 2. Home page
  targetPath = isEn ? '/' : '/en';
} else if (slugMap[normalizedPath]) {
  // 3. Known translation from map
  targetPath = slugMap[normalizedPath][targetLocale];
} else {
  // 4. Fallback: just toggle /en/ prefix
  if (isEn) {
    // Remove /en prefix
    targetPath = normalizedPath.replace(/^\/en/, '') || '/';
  } else {
    // Add /en prefix
    targetPath = `/en${normalizedPath}`;
  }
}

// Ensure targetPath has a trailing slash if the current one did (for consistency)
if (pathname.endsWith('/') && !targetPath.endsWith('/')) {
  targetPath += '/';
}
---

<a
  href={targetPath}
  aria-label={targetLabel}
  class={variant === 'button'
    ? "flex items-center justify-center w-full py-4 text-eos-accent font-bold uppercase tracking-widest hover:bg-eos-base rounded-xl transition-colors"
    : "text-sm font-medium hover:text-eos-accent transition-colors duration-200"}
>
  {targetText}
</a>
