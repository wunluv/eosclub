---
interface Props {
  title?: string;
  questions: Array<{
    question: string;
    answer: string;
  }>;
}

const { title, questions = [] } = Astro.props;

const locale = Astro.currentLocale ?? 'de';
const isDE = locale.startsWith('de');
const defaultTitle = isDE ? 'HÃ¤ufige Fragen' : 'Frequently Asked Questions';
---

<section class="bg-eos-base py-16 lg:py-24">
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">

    <h2 class="text-2xl lg:text-3xl font-bold text-eos-zen mb-10">
      {title ?? defaultTitle}
    </h2>

    <div class="space-y-2" role="list">
      {questions.map((faq, i) => (
        <details
          class="faq-item group border border-eos-subtle rounded-xl overflow-hidden bg-eos-base"
          role="listitem"
        >
          <summary class="flex items-center justify-between px-6 py-5 cursor-pointer list-none select-none text-eos-zen font-semibold text-base lg:text-lg hover:text-eos-accent transition-colors duration-200">
            <span>{faq.question}</span>
            <!-- Chevron icon (feather-icons chevron-down) -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="faq-chevron flex-shrink-0 ml-4 transition-transform duration-300 group-open:rotate-180"
              aria-hidden="true"
            >
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </summary>

          <div class="faq-answer px-6 pb-5 pt-0 text-eos-text text-sm lg:text-base leading-relaxed">
            <Fragment set:html={faq.answer} />
          </div>
        </details>
      ))}
    </div>

  </div>
</section>

<style>
  /* Remove default marker in all browsers */
  details > summary {
    list-style: none;
  }
  details > summary::-webkit-details-marker {
    display: none;
  }

  /* Smooth answer reveal using max-height transition */
  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding-bottom 0.3s ease;
  }

  details[open] .faq-answer {
    max-height: 600px;
    padding-bottom: 1.25rem;
  }
</style>

<script>
  function initFaqAccordion() {
    const allDetails = document.querySelectorAll('.faq-item');

    allDetails.forEach((detail) => {
      detail.addEventListener('toggle', () => {
        if ((detail as HTMLDetailsElement).open) {
          allDetails.forEach((other) => {
            if (other !== detail && (other as HTMLDetailsElement).open) {
              (other as HTMLDetailsElement).open = false;
            }
          });
        }
      });
    });
  }

  initFaqAccordion();
  document.addEventListener('astro:after-swap', initFaqAccordion);
</script>