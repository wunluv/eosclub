---
/**
 * BsportLeadCapture.astro
 *
 * Renders the bsport lead acquisition / contact capture form widget.
 * widgetType: "newsletterV2"
 * dialogMode: 3 = inline embed
 *
 * All visual overrides are handled locally via <style is:inline> below.
 * The bsport admin "Custom CSS" should be left at defaults or minimal.
 *
 * Usage:
 *   <BsportLeadCapture />
 *
 * Requires BaseLayout.astro to expose <slot name="head" /> inside its <head> block.
 */

interface Props {
  fieldsType?: "emailOnly" | "firstNameAndEmail" | "fullNameAndEmail";
  showSubtitle?: boolean;
  showSuccessTitle?: boolean;
  showSuccessText?: boolean;
}

const {
  fieldsType = "emailOnly",
  showSubtitle = false,
  showSuccessTitle = true,
  showSuccessText = true,
} = Astro.props;

const WIDGET_ELEMENT_ID = "bsport-widget-263658";
const COMPANY_ID = 5082;
---

<Fragment slot="head">
  <script id="insert-bsport-widget-cdn" is:inline>
    !function (b, s, p, o, r, t) {
      typeof window.BsportWidget === "undefined" &&
        !document.getElementById("bsport-widget-cdn") &&
        !function () {
          var m = b.createElement(s);
          m.id = "bsport-widget-cdn";
          m.src = p;
          b.getElementsByTagName("head")[0].appendChild(m);
        }();
    }(document, "script", "https://cdn.bsport.io/scripts/widget.js");
  </script>
</Fragment>

<!-- Mount target -->
<div id={WIDGET_ELEMENT_ID} class="bsport-lead-capture"></div>

<!--
  ALL visual overrides live here — not in bsport admin panel.
  Uses [id*="bsport-widget"] .cleanslate prefix to match widget's
  own specificity. Every rule uses !important to beat JSS runtime styles.
-->
<style is:inline>
  /* ── Transparent backgrounds on EVERY wrapper layer ── */
  [id*="bsport-widget"],
  [id*="bsport-widget"] > .cleanslate,
  [id*="bsport-widget"] .cleanslate,
  [id*="bsport-widget"] .cleanslate > div,
  [id*="bsport-widget"] .cleanslate > div > div,
  [id*="bsport-widget"] .cleanslate > div > div > div,
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__container,
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root {
    background: transparent !important;
    background-color: transparent !important;
    box-shadow: none !important;
    border: none !important;
    padding: 0 !important;
  }

  /* ── Hide Email label — placeholder "Email" is sufficient ── */
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__field-label,
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__label,
  [id*="bsport-widget"] .cleanslate label {
    display: none !important;
  }

  /* ── Input wrapper — no border, transparent bg, subtle underline ── */
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__wrapper {
    background: transparent !important;
    background-color: transparent !important;
    border: none !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.25) !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    overflow: visible !important;
    margin-bottom: 0.75rem !important;
  }
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__wrapper:focus-within {
    border-bottom-color: #FF2E00 !important;
    box-shadow: none !important;
  }

  /* ── Input and its container ── */
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__container,
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__field-input-container,
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__input__container {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }

  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__field-input,
  [id*="bsport-widget"] .cleanslate .bs-fabrique-textfield__input,
  [id*="bsport-widget"] .cleanslate .bs-fabrique-input-base {
    background: transparent !important;
    color: white !important;
    padding: 0.75rem 0 !important;
    font-family: 'Geist Sans', 'Inter', sans-serif !important;
    font-size: 0.875rem !important;
    border: none !important;
    border-radius: 0 !important;
  }

  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__field-input::placeholder,
  [id*="bsport-widget"] .cleanslate .bs-fabrique-input-base::placeholder {
    color: rgba(255, 255, 255, 0.4) !important;
  }

  /* ── Submit button ── */
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__submit {
    background-color: #FF2E00 !important;
    color: white !important;
    font-family: 'Geist Sans', 'Inter', sans-serif !important;
    font-weight: 700 !important;
    font-size: 0.75rem !important;
    text-transform: uppercase !important;
    letter-spacing: 0.1em !important;
    border: none !important;
    border-radius: 9999px !important;
    padding: 1rem 1.5rem !important;
    width: 100% !important;
    margin-top: 0.5rem !important;
    cursor: pointer !important;
    transition: opacity 0.2s ease !important;
  }
  [id*="bsport-widget"] .cleanslate .bs-newsletter-form__root__form__submit:hover {
    opacity: 0.88 !important;
  }

  /* ── Hide bsport powered-by / logo — aggressive selectors ── */
  [id*="bsport-widget"] .cleanslate a[href*="bsport"],
  [id*="bsport-widget"] .cleanslate a[href*="pro.bsport"],
  [id*="bsport-widget"] .cleanslate img[alt="bsport"],
  [id*="bsport-widget"] .cleanslate img[src*="bsport_logo"],
  [id*="bsport-widget"] .cleanslate [class*="jss3"],
  [id*="bsport-widget"] .cleanslate span[class*="MuiTypography"] {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    overflow: hidden !important;
  }
</style>

<!-- Global mount function -->
<script id="bsport-widget-mount" is:inline>
  function MountBsportWidget(config, repeat) {
    repeat = repeat || 1;
    if (repeat > 50) return;
    if (!window.BsportWidget) {
      return setTimeout(function () {
        MountBsportWidget(config, repeat + 1);
      }, 100 * repeat || 1);
    }
    BsportWidget.mount(config);
  }
</script>

<!-- Widget config -->
<script
  is:inline
  define:vars={{ WIDGET_ELEMENT_ID, COMPANY_ID, fieldsType, showSubtitle, showSuccessTitle, showSuccessText }}
>
  MountBsportWidget({
    parentElement: WIDGET_ELEMENT_ID,
    companyId: COMPANY_ID,
    franchiseId: null,
    dialogMode: 3,
    widgetType: "newsletterV2",
    showFab: false,
    fullScreenPopup: false,
    styles: undefined,
    config: {
      newsletterV2: {
        fieldsType: fieldsType,
        showSubtitle: showSubtitle,
        showSuccessTitle: showSuccessTitle,
        showSuccessText: showSuccessText
      }
    }
  });
</script>
